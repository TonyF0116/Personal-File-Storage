(function(){var e={7901:function(e,t,i){"use strict";var a=i(9963),o=i(6252);const n={id:"app"};function s(e,t,i,a,s,l){const r=(0,o.up)("router-view");return(0,o.wg)(),(0,o.iD)("div",n,[(0,o.Wm)(r)])}var l={name:"App"},r=i(3744);const u=(0,r.Z)(l,[["render",s]]);var _=u,p=i(2201),c=i(3577);const d={key:0},h={class:"page_title"},g={key:0},f=(0,o._)("h2",null,"Customize your avatar and nickname!",-1),m={class:"nickname"},w=(0,o._)("label",{for:"nickname"},"Nickname ",-1),v=(0,o._)("label",{for:"avatar_input",class:"choose_avatar_button"},"Choose Avatar",-1),y=["src"],b={style:{"margin-top":"-400px"}},k={style:{"margin-top":"40%"}},x={key:1},z={style:{color:"red"}},C={class:"popup_content"},D={class:"form_group"},q=(0,o._)("label",{for:"username"},"Username ",-1),$={class:"form_group"},A=(0,o._)("label",{for:"password"},"Password ",-1),Z={style:{"font-size":"medium",color:"red"}},U={key:0},j={key:1};function P(e,t,i,n,s,l){return null==s.authorization_token||s.new_user?((0,o.wg)(),(0,o.iD)("div",d,[(0,o._)("div",h,(0,c.zw)(s.page_title),1),s.new_user?((0,o.wg)(),(0,o.iD)("div",g,[f,(0,o._)("div",m,[w,(0,o.wy)((0,o._)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>s.nickname=e),id:"nickname"},null,512),[[a.nr,s.nickname]])]),(0,o._)("input",{type:"file",id:"avatar_input",onChange:t[1]||(t[1]=(...e)=>l.choose_avatar_clicked&&l.choose_avatar_clicked(...e)),accept:".jpg, .jpeg, .png"},null,32),v,s.avatar?((0,o.wg)(),(0,o.iD)("img",{key:0,class:"preview_avatar",src:s.avatar,alt:"Image"},null,8,y)):(0,o.kq)("",!0),(0,o._)("h4",b,(0,c.zw)(s.file_upload_message),1),(0,o._)("button",{class:"submit_button",onClick:t[2]||(t[2]=(...e)=>l.submit&&l.submit(...e))},"Finished!"),(0,o._)("h3",k,(0,c.zw)(s.submit_message),1)])):((0,o.wg)(),(0,o.iD)("div",x,[(0,o._)("button",{class:"login_button",onClick:t[3]||(t[3]=(...e)=>l.toggle_popup_login&&l.toggle_popup_login(...e))},"Login"),(0,o._)("button",{class:"signup_button",onClick:t[4]||(t[4]=(...e)=>l.toggle_popup_signup&&l.toggle_popup_signup(...e))},"Sign up"),(0,o._)("h2",z,(0,c.zw)(s.account_warning_msg),1),(0,o.Wm)(a.uT,{name:"fade"},{default:(0,o.w5)((()=>[s.is_popup_visible?((0,o.wg)(),(0,o.iD)("div",{key:0,class:"popup",onClick:t[11]||(t[11]=(0,a.iM)(((...e)=>l.closePopup&&l.closePopup(...e)),["self"]))},[(0,o._)("div",C,[(0,o._)("div",D,[q,(0,o.wy)((0,o._)("input",{type:"text",name:"username",id:"username","onUpdate:modelValue":t[5]||(t[5]=e=>s.username=e),onKeyup:t[6]||(t[6]=(0,a.D2)(((...e)=>l.enter_handler&&l.enter_handler(...e)),["enter"]))},null,544),[[a.nr,s.username]])]),(0,o._)("div",$,[A,(0,o.wy)((0,o._)("input",{type:"password",name:"password",id:"password","onUpdate:modelValue":t[7]||(t[7]=e=>s.password=e),onKeyup:t[8]||(t[8]=(0,a.D2)(((...e)=>l.enter_handler&&l.enter_handler(...e)),["enter"]))},null,544),[[a.nr,s.password]])]),(0,o._)("div",Z,(0,c.zw)(s.warning),1),s.login_pressed?((0,o.wg)(),(0,o.iD)("div",U,[(0,o._)("button",{class:"popup_button",onClick:t[9]||(t[9]=(...e)=>l.login&&l.login(...e))},"Login")])):((0,o.wg)(),(0,o.iD)("div",j,[(0,o._)("button",{class:"popup_button",onClick:t[10]||(t[10]=(...e)=>l.signup&&l.signup(...e))},"Sign up")]))])])):(0,o.kq)("",!0)])),_:1})]))])):(0,o.kq)("",!0)}i(7658);var O=i(2153),S=i.n(O),F=i(6154);F.Z.defaults.baseURL="http://127.0.0.1:5000";var E={data(){return{page_title:"Welcome!",is_popup_visible:!1,login_pressed:!0,username:"",password:"",warning:"",new_user:!1,account_id:0,avatar:null,file_upload_message:"",nickname:"",submit_message:"",avatar_data:null,avatar_name:"",account_warning_msg:"",authorization_token:""}},mounted(){""!=this.$route.query.Authorization&&(this.authorization_token=this.$route.query.Authorization,F.Z.defaults.headers.common["Authorization"]=this.$route.query.Authorization,this.initialize_account_page()),this.account_warning_msg=this.$route.query.warning},methods:{initialize_account_page(){F.Z.post("/api/account?redirection="+this.$route.query.redirection+"&file_id="+this.$route.query.file_id).then((e=>{console.log(e),"Authorized"==e.data.msg&&this.$router.push({path:this.$route.query.redirection,query:{file_id:this.$route.query.file_id,Authorization:e.data.data.token}})}),(e=>{console.log(e)}))},submit(){if(this.submit_message="",""==this.nickname)return void(this.submit_message="Empty nickname");if(null==this.avatar)return void(this.submit_message="No avatar chosen");const e=new FormData;e.append("avatar",this.avatar_data),e.append("avatar_name",this.avatar_name),e.append("nickname",this.nickname),e.append("account_id",this.account_id),this.submit_message="Submitting",F.Z.post("/api/account/new_user_info",e).then((e=>{this.submit_message=e.data.msg,this.$router.push({path:"/index",query:{Authorization:this.authorization_token}})}),(e=>{console.log(e)}))},choose_avatar_clicked(e){const t=e.target.files[0];if(this.file_upload_message="",this.avatar=null,this.avatar_name=t.name,t)if(["image/jpg","image/jpeg","image/png"].includes(t.type)){const e=new FileReader;e.readAsDataURL(t),e.onload=()=>{this.avatar=e.result,this.avatar_data=e.result.split(",")[1]}}else this.file_upload_message="Invalid file type"},enter_handler(){this.login_pressed?this.login():this.signup()},toggle_popup_login(){this.is_popup_visible=!0,this.login_pressed=!0},toggle_popup_signup(){this.is_popup_visible=!0,this.login_pressed=!1},closePopup(){this.is_popup_visible=!1,this.username="",this.password="",this.warning=""},check_empty(){return this.warning="",""==this.username?"Username can not be empty":""==this.password?"Password can not be empty":""},login(){if(""!=this.check_empty())return void(this.warning=this.check_empty());const e=new FormData;e.append("username",this.username),e.append("password_hash",S()(this.password).toString()),F.Z.post("/api/account/login",e).then((e=>{console.log(e),this.$router.push({path:e.data.data.redirection,query:{Authorization:e.data.data.token}})}),(e=>{this.warning=e.response.data.msg,console.log(e)}))},signup(){if(""!=this.check_empty())return void(this.warning=this.check_empty());const e=new FormData;e.append("username",this.username),e.append("password_hash",S()(this.password).toString()),F.Z.post("/api/account/signup",e).then((e=>{console.log(e),this.new_user=!0,this.account_id=e.data.data.account_id,this.authorization_token=e.data.data.token}),(e=>{this.warning=e.response.data.msg,console.log(e)}))}}};const V=(0,r.Z)(E,[["render",P]]);var L=V;const T=["src"],I={style:{"text-align":"right"}},R={class:"page_title"},W=(0,o._)("label",{style:{position:"absolute",top:"10%",left:"25%",transform:"translate(-50%, -50%)"}},"Filename",-1),H={class:"popup_content"},K=(0,o._)("label",{for:"fileInput",class:"choose_file_button"},"Choose File",-1),N={key:0},Y={key:0},M=["href"],G={style:{"text-align":"center"}},B={style:{right:"0%"}},J=["href","download"],Q=["onClick"],X=(0,o._)("hr",null,null,-1);function ee(e,t,i,n,s,l){return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("img",{src:`/avatar?account_id=${this.account_id}&suffix=${this.avatar_suffix}`,class:"avatar",alt:"avatar"},null,8,T),(0,o._)("h3",I,"Welcome, "+(0,c.zw)(s.name),1),(0,o._)("div",R,(0,c.zw)(s.page_title),1),W,(0,o.wy)((0,o._)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>s.new_file_name=e),style:{position:"absolute",top:"15%",left:"25%",transform:"translate(-50%, -50%)"}},null,512),[[a.nr,s.new_file_name]]),(0,o._)("button",{style:{position:"absolute",top:"20%",left:"25%",transform:"translate(-50%, -50%)"},onClick:t[1]||(t[1]=(...e)=>l.new_excel_file&&l.new_excel_file(...e))},"New Excel File"),(0,o._)("button",{class:"generate_button",onClick:t[2]||(t[2]=(...e)=>l.generate_file_stat&&l.generate_file_stat(...e))},"Generate File Stat"),(0,o._)("button",{class:"upload_button",onClick:t[3]||(t[3]=(...e)=>l.show_popup&&l.show_popup(...e))},"Upload"),(0,o.Wm)(a.uT,{name:"fade"},{default:(0,o.w5)((()=>[s.is_pop_up_visible?((0,o.wg)(),(0,o.iD)("div",{key:0,class:"popup",onClick:t[6]||(t[6]=(0,a.iM)(((...e)=>l.close_popup&&l.close_popup(...e)),["self"]))},[(0,o._)("div",H,[(0,o._)("input",{type:"file",id:"fileInput",onChange:t[4]||(t[4]=(...e)=>l.choose_file_clicked&&l.choose_file_clicked(...e)),accept:".jpg, .jpeg, .png, .pdf, .xls, .xlsx"},null,32),K,(0,o._)("p",null,(0,c.zw)(s.choose_file_message),1),""!=s.choose_file_message&&"Unaccepted file format"!=s.choose_file_message?((0,o.wg)(),(0,o.iD)("div",N,[(0,o._)("button",{class:"submit_button",onClick:t[5]||(t[5]=(...e)=>l.upload_file&&l.upload_file(...e))},"Submit"),(0,o._)("p",null,(0,c.zw)(s.upload_msg),1)])):(0,o.kq)("",!0)])])):(0,o.kq)("",!0)])),_:1}),1==s.administration?((0,o.wg)(),(0,o.iD)("div",Y,[(0,o._)("button",{onClick:t[7]||(t[7]=(...e)=>l.show_logged_in_users&&l.show_logged_in_users(...e))},"Show logged in users")])):(0,o.kq)("",!0),(0,o._)("ol",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(s.files,(e=>((0,o.wg)(),(0,o.iD)("li",{key:e},[(0,o._)("a",{href:"/edit?file_id="+e[0]+"&Authorization="+this.$route.query.Authorization,style:{float:"left"}},(0,c.zw)(e[2]),9,M),(0,o._)("span",G,(0,c.zw)(e[4]),1),(0,o._)("span",B,[(0,o._)("a",{href:"/api/index/download?file_id="+e[0]+"&Authorization="+this.$route.query.Authorization,download:e[2]}," Download",8,J)]),(0,o._)("button",{onClick:t=>l.delete_file(e[0]),style:{right:"0%"}},"Delete",8,Q),X])))),128))])],64)}F.Z.defaults.baseURL="http://127.0.0.1:5000";var te={data(){return{page_title:"Index Page",account_id:0,name:"",administration:0,avatar_suffix:"suffix",files:null,is_pop_up_visible:!1,choose_file_message:"",upload_msg:"",file_to_upload:null,new_file_name:""}},mounted(){F.Z.defaults.headers.common["Authorization"]=this.$route.query.Authorization,this.initialize_index_page()},methods:{show_logged_in_users(){F.Z.post("/api/account/get_logged_in_users").then((e=>{alert(e.data.data.users)}),(e=>{console.log(e)}))},new_excel_file(){""!=this.new_file_name?F.Z.post("/api/index/new_excel_file?file_name="+this.new_file_name+"&account_id="+this.account_id).then((e=>{console.log(e),this.initialize_index_page()}),(e=>{console.log(e)})):alert("Empty file name!")},delete_file(e){F.Z.delete("/api/index/delete?file_id="+e).then((e=>{console.log(e),this.initialize_index_page()}),(e=>{console.log(e)}))},generate_file_stat(){F.Z.post("/api/index/file_stat_generation?account_id="+this.account_id,{}).then((e=>{console.log(e),this.initialize_index_page()}),(e=>{console.log(e)}))},choose_file_clicked(e){if(e.target.files.length>0){this.file_to_upload=e.target.files[0];const t=["jpg","jpeg","png","pdf","xls","xlsx"],i=this.file_to_upload.name.substring(this.file_to_upload.name.lastIndexOf(".")+1).toLowerCase();t.includes(i)?this.choose_file_message=this.file_to_upload.name:(this.choose_file_message="Unaccepted file format",this.file_to_upload=null)}else this.choose_file_message=""},upload_file(){const e=new FormData;e.append("file",this.file_to_upload),e.append("account_id",this.account_id),this.upload_msg="Uploading",F.Z.post("/api/index/upload_file",e).then((e=>{this.upload_msg=e.data.msg,this.initialize_index_page(),this.close_popup()}),(e=>{console.log(e)}))},show_popup(){this.is_pop_up_visible=!0},close_popup(){this.is_pop_up_visible=!1,this.choose_file_message="",this.file_to_upload=null,this.upload_msg=""},initialize_index_page(){F.Z.post("/api/index",{}).then((e=>{console.log(e),this.account_id=e.data.data.user_info[0][0],null!=e.data.data.user_info[0][2]?this.name=e.data.data.user_info[0][2]:this.name=e.data.data.user_info[0][1],this.administration=e.data.data.user_info[0][3],this.avatar_suffix=e.data.data.user_info[0][4],this.files=e.data.data.user_files}),(e=>{console.log(e),302!=e.response.status&&401!=e.response.status||this.$router.push(e.response.data.data.redirection)}))},goToEditPage(){this.$router.push({path:"/edit",query:{Authorization:this.$route.query.Authorization}})}}};const ie=(0,r.Z)(te,[["render",ee]]);var ae=ie;const oe=(0,o._)("label",{style:{position:"absolute",left:"25%",top:"5%"}},"Email address",-1),ne={class:"page_title"},se={key:0},le=["src"],re={key:1},ue={class:"prev_next_button"},_e={ref:"canvas"},pe={key:2},ce=["onUpdate:modelValue"],de=["onClick"];function he(e,t,i,n,s,l){return(0,o.wg)(),(0,o.iD)(o.HY,null,[oe,(0,o.wy)((0,o._)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>s.email=e),style:{position:"absolute",left:"25%",top:"10%"}},null,512),[[a.nr,s.email]]),(0,o._)("button",{style:{position:"absolute",left:"25%",top:"20%"},onClick:t[1]||(t[1]=(...e)=>l.share_file&&l.share_file(...e))},"Share"),(0,o._)("button",{style:{position:"absolute",left:"10%",top:"5%"},onClick:t[2]||(t[2]=(...e)=>l.back_to_index_page&&l.back_to_index_page(...e))},"Back"),(0,o._)("div",ne,(0,c.zw)(s.page_title),1),0==s.file_type?((0,o.wg)(),(0,o.iD)("div",se,[(0,o._)("img",{src:`/api/edit/get_file?file_id=${this.file_id}&account_id=${this.account_id}`,class:"image",alt:"image"},null,8,le)])):(0,o.kq)("",!0),1==s.file_type?((0,o.wg)(),(0,o.iD)("div",re,[(0,o._)("h3",null,"Total page: "+(0,c.zw)(s.total_page_num)+", Cur page: "+(0,c.zw)(s.cur_page),1),(0,o._)("div",ue,[(0,o._)("button",{onClick:t[3]||(t[3]=(...e)=>l.prev_page&&l.prev_page(...e))},"Prev"),(0,o._)("button",{onClick:t[4]||(t[4]=(...e)=>l.next_page&&l.next_page(...e))},"Next")]),(0,o._)("canvas",_e,null,512)])):(0,o.kq)("",!0),2==s.file_type?((0,o.wg)(),(0,o.iD)("div",pe,[(0,o._)("button",{style:{position:"absolute",left:"80%",top:"5%"},onClick:t[5]||(t[5]=(...e)=>l.excel_to_pdf&&l.excel_to_pdf(...e))},"Create pdf from excel"),(0,o._)("table",null,[(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(s.excel_data,((e,t)=>((0,o.wg)(),(0,o.iD)("tr",{key:t},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e,((e,i)=>((0,o.wg)(),(0,o.iD)("td",{key:i},[(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":e=>s.excel_data[t][i]=e},null,8,ce),[[a.nr,s.excel_data[t][i]]])])))),128)),(0,o._)("button",{style:{"margin-top":"18px"},onClick:t=>l.add_cell(e)},"Add Cell",8,de)])))),128)),(0,o._)("button",{style:{"margin-top":"10px"},onClick:t[6]||(t[6]=(...e)=>l.add_row&&l.add_row(...e))},"Add Row")])]),(0,o._)("button",{onClick:t[7]||(t[7]=(...e)=>l.save_excel&&l.save_excel(...e))},"Save")])):(0,o.kq)("",!0)],64)}i(1439),i(7585),i(5315);var ge=i(9299),fe=i(9016),me=i.n(fe),we=i(4105);F.Z.defaults.baseURL="http://127.0.0.1:5000",ge.GlobalWorkerOptions.workerSrc=me();var ve={data(){return{page_title:"Edit Page",file_id:null,account_id:null,file_type:null,total_page_num:null,cur_page:1,excel_data:[],email:""}},mounted(){F.Z.defaults.headers.common["Authorization"]=this.$route.query.Authorization,this.initialize_edit_page()},methods:{share_file(){""!=this.email?F.Z.post("/api/edit/share?file_id="+this.file_id+"&email="+this.email).then((e=>{console.log(e),alert("Successfully shared!")})).catch((e=>{console.error(e)})):alert("Email address cannot be empty!")},excel_to_pdf(){F.Z.post("/api/edit/excel_to_pdf?file_id="+this.file_id).then((e=>{console.log(e),this.$router.push("/index?Authorization="+this.$route.query.Authorization)})).catch((e=>{console.error(e)}))},back_to_index_page(){this.$router.push("/index?Authorization="+this.$route.query.Authorization)},save_excel(){F.Z.post("/api/edit/save_excel?file_id="+this.file_id,this.excel_data).then((e=>{console.log(e.data)})).catch((e=>{console.error(e)}))},add_row(){this.excel_data.push([""])},add_cell(e){e.push("")},load_excel(){F.Z.get("/api/edit/get_file?file_id="+this.file_id+"&account_id="+this.account_id,{responseType:"arraybuffer"}).then((e=>{const t=new Uint8Array(e.data),i=(0,we.ij)(t,{type:"array"});this.excel_data=we.P6.sheet_to_json(i.Sheets[i.SheetNames[0]],{header:1})})).catch((e=>{console.error(e)}))},prev_page(){1==this.cur_page?this.cur_page=this.total_page_num:this.cur_page=this.cur_page-1,this.load_pdf()},next_page(){this.cur_page==this.total_page_num?this.cur_page=1:this.cur_page=this.cur_page+1,this.load_pdf()},async load_pdf(){const e="/api/edit/get_file?file_id="+this.file_id+"&account_id="+this.account_id,t=(0,ge.getDocument)(e);try{const e=await t.promise;this.total_page_num=e.numPages;const i=await e.getPage(this.cur_page),a=this.$refs.canvas,o=i.getViewport({scale:1.5});a.width=o.width,a.height=o.height;const n={canvasContext:a.getContext("2d"),viewport:o};await i.render(n)}catch(i){console.error("Error loading PDF:",i)}},initialize_edit_page(){this.file_id=this.$route.query.file_id,F.Z.post("/api/edit?file_id="+this.file_id,{}).then((e=>{this.account_id=e.data.data.account_id,this.file_type=e.data.data.file_type,console.log(e),1==this.file_type?this.load_pdf():2==this.file_type&&this.load_excel()}),(e=>{console.log(e),302!=e.response.status&&401!=e.response.status||this.$router.push(e.response.data.data.redirection)}))}}};const ye=(0,r.Z)(ve,[["render",he]]);var be=ye;const ke=[{path:"/",redirect:"/index"},{path:"/account",component:L},{path:"/index",component:ae},{path:"/edit",component:be}],xe=(0,p.p7)({history:(0,p.PO)(),routes:ke});var ze=xe;(0,a.ri)(_).use(ze).mount("#app")},2480:function(){},3414:function(){},172:function(){},2001:function(){},3779:function(){},6558:function(){},2258:function(){}},t={};function i(a){var o=t[a];if(void 0!==o)return o.exports;var n=t[a]={exports:{}};return e[a].call(n.exports,n,n.exports,i),n.exports}i.m=e,function(){var e=[];i.O=function(t,a,o,n){if(!a){var s=1/0;for(_=0;_<e.length;_++){a=e[_][0],o=e[_][1],n=e[_][2];for(var l=!0,r=0;r<a.length;r++)(!1&n||s>=n)&&Object.keys(i.O).every((function(e){return i.O[e](a[r])}))?a.splice(r--,1):(l=!1,n<s&&(s=n));if(l){e.splice(_--,1);var u=o();void 0!==u&&(t=u)}}return t}n=n||0;for(var _=e.length;_>0&&e[_-1][2]>n;_--)e[_]=e[_-1];e[_]=[a,o,n]}}(),function(){i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,{a:t}),t}}(),function(){i.d=function(e,t){for(var a in t)i.o(t,a)&&!i.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};i.O.j=function(t){return 0===e[t]};var t=function(t,a){var o,n,s=a[0],l=a[1],r=a[2],u=0;if(s.some((function(t){return 0!==e[t]}))){for(o in l)i.o(l,o)&&(i.m[o]=l[o]);if(r)var _=r(i)}for(t&&t(a);u<s.length;u++)n=s[u],i.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return i.O(_)},a=self["webpackChunkpersonal_file_storage"]=self["webpackChunkpersonal_file_storage"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=i.O(void 0,[998],(function(){return i(7901)}));a=i.O(a)})();
//# sourceMappingURL=app.04d76238.js.map